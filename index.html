<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Planner Yourself 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { --brand-color: #6366f1; }
        body { font-family:'Plus Jakarta Sans',sans-serif; background:#F8FAFC; color: #1e293b; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        .glass-header { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0, 0, 0, 0.05); }
        .tab-content { display:none }
        .tab-content.active { display:block; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .active-nav { color: var(--brand-color) !important; font-weight: 800; position: relative; }
        .active-nav::after { content: ''; position: absolute; bottom: -2px; left: 50%; transform: translateX(-50%); width: 16px; height: 3px; background: var(--brand-color); border-radius: 10px; }
        .active-user-btn { background: white !important; color: var(--brand-color) !important; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .card-clean { background: white; border-radius: 1.5rem; border: 1px solid #F1F5F9; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02); }
        .riscado { text-decoration: line-through; opacity: 0.35; filter: grayscale(1); }
        .main-container { width: 100%; max-width: 600px; margin: 0 auto; padding: 0 1.25rem; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .calendar-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; border-radius: 12px; background: #fff; border: 1px solid #f1f5f9; cursor: pointer; }
        .calendar-day.has-event { border: 2px solid var(--brand-color); background: #f5f3ff; color: var(--brand-color); }
        #modal-calendario { display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); z-index: 200; align-items: center; justify-content: center; padding: 1rem; }
        #modal-calendario.active { display: flex; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="pb-24">

<div id="modal-calendario">
    <div class="bg-white w-full max-w-md rounded-[2.5rem] p-6 max-h-[90vh] overflow-y-auto no-scrollbar relative shadow-2xl">
        <button onclick="toggleCalendario()" class="absolute top-6 right-6 text-slate-300 font-bold">âœ•</button>
        <h2 class="text-lg font-black text-slate-800 mb-6 text-center">ğŸ“… CalendÃ¡rio 2026</h2>
        <div class="calendar-grid mb-6" id="calendar-grid-container"></div>
        <div id="calendar-details" class="space-y-3 border-t pt-4"></div>
    </div>
</div>

<section id="login-screen" class="fixed inset-0 bg-white z-[100] flex items-center justify-center p-6 text-center">
    <div class="w-full max-w-sm space-y-8">
        <div class="inline-block p-4 bg-indigo-50 rounded-3xl text-indigo-600 font-black text-2xl rotate-3">PY</div>
        <div>
            <h1 class="text-2xl font-black text-slate-800">Planner <span class="text-indigo-600 italic">Yourself</span></h1>
            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">GestÃ£o Familiar 2026</p>
        </div>
        <div class="space-y-3">
            <input id="auth-nome" type="text" placeholder="@famÃ­lia" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none text-center border-2 border-transparent focus:border-indigo-100 transition-all">
            <input id="auth-senha" type="password" placeholder="Senha" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none text-center border-2 border-transparent focus:border-indigo-100 transition-all">
            <button onclick="executarAuth()" class="w-full bg-indigo-600 text-white p-5 rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl">Acessar Painel</button>
            <button onclick="prepararCadastro()" class="w-full text-indigo-400 p-2 rounded-2xl font-bold text-[11px] uppercase tracking-widest">âœ¨ Cadastrar</button>
        </div>
    </div>
</section>

<div id="main-app" class="hidden">
    <header class="glass-header sticky top-0 z-50">
        <div class="main-container text-center">
            <div class="flex flex-col items-center pt-6 pb-2">
                <h1 class="text-lg font-extrabold text-slate-800">Planner <span class="text-indigo-600">Yourself</span></h1>
                <span id="display-grupo" class="text-[8px] font-black text-slate-300 uppercase tracking-widest mt-1"></span>
            </div>
            <div class="flex justify-between items-center py-4 gap-3">
                <div class="flex bg-slate-100 p-1 rounded-2xl w-full">
                    <button id="btn-user1" onclick="switchUser(db.config.user1)" class="flex-1 py-2 text-[10px] font-bold rounded-xl uppercase transition-all"></button>
                    <button id="btn-user2" onclick="switchUser(db.config.user2)" class="flex-1 py-2 text-[10px] font-bold rounded-xl uppercase transition-all"></button>
                </div>
                <button onclick="logout()" class="flex items-center justify-center bg-rose-50 text-rose-500 min-w-[44px] h-[44px] rounded-2xl border border-rose-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                </button>
            </div>
            <nav class="flex overflow-x-auto no-scrollbar gap-1 pb-2">
                <button id="nav-casa" onclick="showTab('casa')" class="nav-item active-nav px-4 py-3 text-[10px] font-bold uppercase whitespace-nowrap">Tarefas</button>
                <button id="nav-agenda" onclick="showTab('agenda')" class="nav-item text-slate-400 px-4 py-3 text-[10px] font-bold uppercase whitespace-nowrap">Agenda</button>
                <button id="nav-financeiro" onclick="showTab('financeiro')" class="nav-item text-slate-400 px-4 py-3 text-[10px] font-bold uppercase whitespace-nowrap">FinanÃ§as</button>
                <button id="nav-compras" onclick="showTab('compras')" class="nav-item text-slate-400 px-4 py-3 text-[10px] font-bold uppercase whitespace-nowrap">Compras</button>
                <button id="nav-lazer" onclick="showTab('lazer')" class="nav-item text-slate-400 px-4 py-3 text-[10px] font-bold uppercase whitespace-nowrap">Lazer</button>
                <button id="nav-logs" onclick="showTab('logs')" class="nav-item text-slate-400 px-4 py-3 text-[10px] font-bold uppercase whitespace-nowrap">Logs</button>
                <button id="nav-perfil" onclick="showTab('perfil')" class="nav-item text-slate-400 px-4 py-3 text-[10px] font-bold uppercase whitespace-nowrap">Perfil</button>
            </nav>
        </div>
    </header>

    <main class="main-container mt-6 space-y-8">
        <section id="content-casa" class="tab-content active space-y-4">
            <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar" id="list-dias"></div>
            <div class="card-clean p-2 flex gap-2">
                <input id="novaTarefa" placeholder="No que focar agora?" class="flex-1 bg-transparent outline-none font-bold text-sm px-4">
                <button onclick="addTarefa()" class="bg-indigo-600 text-white w-12 h-12 rounded-2xl font-black shadow-lg">+</button>
            </div>
            <div id="tarefasList" class="space-y-3"></div>
        </section>

        <section id="content-agenda" class="tab-content space-y-4">
            <button onclick="toggleCalendario()" class="w-full bg-white border p-4 rounded-2xl font-black text-indigo-600 text-[10px] uppercase shadow-sm">ğŸ“… Ver CalendÃ¡rio Completo</button>
            <div class="card-clean p-6 space-y-3">
                <input type="date" id="agendaData" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-center outline-none">
                <input id="agendaComp" placeholder="O que agendar?" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-center outline-none">
                <button onclick="addAgenda()" class="w-full bg-slate-900 text-white p-4 rounded-2xl font-black uppercase text-[10px]">Agendar</button>
            </div>
            <div id="agendaList" class="space-y-3"></div>
        </section>

        <section id="content-financeiro" class="tab-content space-y-4">
            <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar" id="fin-meses-nav"></div>
            
            <button onclick="copiarMesAnterior()" class="w-full bg-amber-50 text-amber-600 p-3 rounded-2xl font-black text-[10px] uppercase border border-amber-100 shadow-sm active:scale-95 transition-all">
                ğŸ“‹ Copiar Dados do MÃªs Anterior
            </button>

            <div class="card-clean p-6 space-y-6">
                <div class="text-center">
                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Dashboard de</p>
                    <p id="fin-user-name" class="text-lg font-black text-indigo-600"></p>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <h3 class="text-[10px] font-black uppercase text-emerald-600 flex items-center gap-2">â¬‡ï¸ Entradas</h3>
                        <button onclick="addNovaEntrada()" class="text-[9px] bg-emerald-50 text-emerald-600 px-2 py-1 rounded-lg font-bold border border-emerald-100">+ Add Entrada</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="bg-slate-50 p-2 rounded-xl"><p class="text-[8px] uppercase font-bold text-slate-400">SalÃ¡rio</p><input onchange="updateFinanca('salario', this.value)" id="in-salario" type="number" class="bg-transparent w-full font-bold outline-none text-emerald-700" placeholder="R$ 0"></div>
                        <div class="bg-slate-50 p-2 rounded-xl"><p class="text-[8px] uppercase font-bold text-slate-400">VR / VA</p><input onchange="updateFinanca('vr', this.value)" id="in-vr" type="number" class="bg-transparent w-full font-bold outline-none text-emerald-700" placeholder="R$ 0"></div>
                        <div id="container-entradas-extras" class="contents"></div>
                        <div class="bg-slate-50 p-2 rounded-xl col-span-2 border-l-4 border-emerald-400"><p class="text-[8px] uppercase font-bold text-slate-400">Entrada Casa (Reserva)</p><input onchange="updateFinanca('entradaCasa', this.value)" id="in-casa-total" type="number" class="bg-transparent w-full font-bold outline-none text-emerald-700" placeholder="R$ 0"></div>
                    </div>
                </div>

                <hr class="border-dashed">

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <h3 class="text-[10px] font-black uppercase text-rose-500 flex items-center gap-2">ğŸ“Œ Custos Fixos</h3>
                        <button onclick="addNovoCustoFixo()" class="text-[9px] bg-rose-50 text-rose-600 px-2 py-1 rounded-lg font-bold border border-rose-100">+ Add Gasto</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="bg-slate-50 p-2 rounded-xl"><p class="text-[8px] uppercase font-bold text-slate-400">Academia</p><input onchange="updateFinanca('fixo_academia', this.value)" id="fixo-academia" type="number" class="bg-transparent w-full font-bold outline-none text-rose-600" placeholder="R$ 0"></div>
                        <div class="bg-slate-50 p-2 rounded-xl"><p class="text-[8px] uppercase font-bold text-slate-400">Celular</p><input onchange="updateFinanca('fixo_celular', this.value)" id="fixo-celular" type="number" class="bg-transparent w-full font-bold outline-none text-rose-600" placeholder="R$ 0"></div>
                        <div class="bg-slate-50 p-2 rounded-xl"><p class="text-[8px] uppercase font-bold text-slate-400">Internet</p><input onchange="updateFinanca('fixo_internet', this.value)" id="fixo-internet" type="number" class="bg-transparent w-full font-bold outline-none text-rose-600" placeholder="R$ 0"></div>
                        <div id="container-fixos-extras" class="contents"></div>
                        <div class="bg-slate-50 p-2 rounded-xl ring-2 ring-indigo-200 col-span-2"><p class="text-[8px] uppercase font-black text-indigo-400">AlimentaÃ§Ã£o (Desconta do VR)</p><input onchange="updateFinanca('fixo_alimentacao', this.value)" id="fixo-alimentacao" type="number" class="bg-transparent w-full font-bold outline-none text-rose-600" placeholder="R$ 0"></div>
                    </div>
                </div>

                <div class="p-4 rounded-2xl bg-indigo-50 border border-indigo-100">
                    <input onchange="updateFinanca('caixinhaNome', this.value)" id="fin-caixinha-nome" placeholder="Nome da Caixinha" class="bg-transparent text-[10px] font-black uppercase text-indigo-400 outline-none w-full mb-1">
                    <input onchange="updateFinanca('caixinhaValor', this.value)" id="fin-caixinha-valor" type="number" class="bg-transparent w-full font-black text-indigo-700 outline-none text-lg" placeholder="R$ 0,00">
                </div>

                <div class="p-4 rounded-2xl bg-amber-50 border border-amber-100">
                    <p class="text-[9px] font-black text-amber-600 uppercase mb-2">ğŸ’° Fluxo Lazer do MÃªs</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div><p class="text-[8px] font-bold text-amber-400 uppercase">Verba Lazer (+)</p><input onchange="updateFinanca('lazerEntrada', this.value)" id="fin-lazer-in" type="number" class="bg-transparent font-bold text-amber-700 outline-none w-full" placeholder="R$ 0"></div>
                        <div><p class="text-[8px] font-bold text-rose-400 uppercase">Gasto Lazer (-)</p><input onchange="updateFinanca('lazerSaida', this.value)" id="fin-lazer-out" type="number" class="bg-transparent font-bold text-rose-700 outline-none w-full" placeholder="R$ 0"></div>
                    </div>
                </div>
            </div>

            <div class="card-clean p-4 bg-white space-y-2">
                <div class="flex justify-between items-center">
                    <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Comprometimento da Renda</span>
                    <span id="fin-percent-text" class="text-[10px] font-bold text-slate-700">0%</span>
                </div>
                <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden">
                    <div id="fin-progress-bar" class="h-full bg-indigo-500 transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>

            <div class="card-clean p-4 bg-white">
                <p class="text-[9px] font-black text-slate-400 uppercase mb-2">ğŸ’¸ Outras SaÃ­das</p>
                <div class="space-y-2">
                    <div class="flex gap-2">
                        <input id="finOutDesc" placeholder="DescriÃ§Ã£o" class="flex-[2] bg-slate-50 p-2 rounded-lg text-sm outline-none font-bold">
                        <select id="finOutCat" class="flex-1 bg-slate-50 p-2 rounded-lg text-[10px] font-black uppercase outline-none">
                            <option value="AlimentaÃ§Ã£o">ğŸ´ AlimentaÃ§Ã£o</option>
                            <option value="Academia">ğŸ’ª Academia</option>
                            <option value="Internet/Celular">ğŸ“± Net/Celular</option>
                            <option value="Transporte">ğŸš— Transporte</option>
                            <option value="SaÃºde">ğŸ¥ SaÃºde</option>
                            <option value="Lazer">ğŸ¿ Lazer</option>
                            <option value="Presentes">ğŸ Presentes</option>
                            <option value="Outros">âš™ï¸ Outros</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <input id="finOutValor" type="number" placeholder="R$" class="flex-1 bg-slate-50 p-2 rounded-lg text-sm outline-none font-bold">
                        <button onclick="addSaidaVariavel()" class="bg-slate-900 text-white px-8 rounded-lg font-bold">+</button>
                    </div>
                </div>
                <div id="fin-lista-saidas" class="mt-4 space-y-4"></div>
                <div id="extra-dash-container"></div>
            </div>
            
            <div class="card-clean p-4 bg-slate-900 text-white flex justify-between items-center">
                <span class="text-[10px] font-black uppercase">Saldo SalÃ¡rio Livre</span>
                <span id="fin-saldo-final" class="text-xl font-bold">R$ 0,00</span>
            </div>
        </section>

        <section id="content-compras" class="tab-content space-y-4">
            <div class="flex gap-2">
                <button onclick="restaurarComprasEssenciais()" class="flex-1 bg-white p-4 rounded-2xl font-black text-[10px] uppercase text-indigo-600 border shadow-sm">ğŸ“¦ Lista Essenciais</button>
                <button onclick="shareWhatsApp()" class="flex-1 bg-emerald-500 p-4 rounded-2xl font-black text-[10px] uppercase text-white shadow-lg">ğŸ“± WhatsApp</button>
            </div>
            <div class="card-clean p-4 space-y-3">
                <div class="flex gap-2">
                    <input id="compraNovoItem" placeholder="Item..." class="flex-1 text-sm font-bold outline-none px-4 bg-slate-50 rounded-xl">
                    <select id="compraCategoria" class="bg-slate-50 p-3 rounded-xl text-[10px] font-black uppercase outline-none">
                        <option value="Mercearia">ğŸ§‚ Mercearia</option>
                        <option value="Hortifruti">ğŸ¥• Hortifruti</option>
                        <option value="AÃ§ougue">ğŸ¥© AÃ§ougue</option>
                        <option value="Padaria">ğŸ¥– Padaria</option>
                        <option value="LaticÃ­nios">ğŸ§€ LaticÃ­nios</option>
                        <option value="Limpeza">ğŸ§¼ Limpeza</option>
                        <option value="Higiene">ğŸ§» Higiene</option>
                        <option value="Pets">ğŸ¾ Pets</option>
                    </select>
                </div>
                <button onclick="addCompraManual()" class="w-full bg-indigo-600 text-white p-4 rounded-xl font-black uppercase text-[10px]">Adicionar</button>
            </div>
            <div id="comprasList" class="space-y-6"></div> 
        </section>

        <section id="content-lazer" class="tab-content space-y-4 text-center">
             <button onclick="sortearLazer()" class="w-full bg-indigo-600 text-white p-6 rounded-3xl font-black uppercase text-xs mb-4 shadow-xl active:scale-95 transition-all">ğŸ° Sortear Qualquer Lugar (No OrÃ§amento)</button>
            <div id="lazer-tabs" class="flex gap-1 bg-white p-1.5 rounded-2xl border overflow-x-auto no-scrollbar"></div>
            <div class="card-clean p-4 bg-indigo-50/50 border-indigo-100">
                <p class="text-[9px] font-black text-indigo-400 uppercase tracking-widest">Saldo Lazer em Caixa (Financeiro)</p>
                <p id="lazer-orcamento-display" class="text-xl font-black text-indigo-700 mt-1">R$ 0,00</p>
            </div>
            <div class="card-clean p-4 space-y-3">
                <div class="flex gap-2">
                    <input id="lazerNovo" placeholder="SugestÃ£o de local..." class="flex-[2] text-sm font-bold outline-none px-4 bg-slate-50 rounded-xl">
                    <input id="lazerCusto" type="number" placeholder="Custo Est." class="flex-1 text-sm font-bold outline-none px-4 bg-slate-50 rounded-xl text-center">
                </div>
                <button onclick="addLazer()" class="w-full bg-slate-900 text-white p-4 rounded-xl font-black uppercase text-[10px]">Adicionar SugestÃ£o na Categoria</button>
            </div>
            <div id="lazerList" class="space-y-2 text-left"></div>
        </section>

        <section id="content-logs" class="tab-content space-y-4">
            <div id="logsDisplay" class="space-y-2"></div>
        </section>

        <section id="content-perfil" class="tab-content space-y-6">
            <div class="card-clean p-4 text-center bg-indigo-600 text-white shadow-lg">
                <p class="text-[9px] font-black uppercase tracking-widest opacity-70">Ranking do Casal</p>
                <div class="flex justify-around mt-3 items-center">
                    <div><p id="label-user1" class="text-[10px] font-bold mb-1 opacity-80 uppercase"></p><p id="ponto-user1" class="text-3xl font-black">0</p></div>
                    <div class="w-px h-8 bg-white/20"></div>
                    <div><p id="label-user2" class="text-[10px] font-bold mb-1 opacity-80 uppercase"></p><p id="ponto-user2" class="text-3xl font-black">0</p></div>
                </div>
            </div>
            <div class="card-clean p-6 space-y-4">
                <input id="input-user1" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-center outline-none">
                <input id="input-user2" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-center outline-none">
                <button onclick="saveUsers()" class="w-full bg-slate-900 text-white p-5 rounded-2xl font-black uppercase text-[10px]">Salvar ConfiguraÃ§Ãµes</button>
            </div>
        </section>
    </main>
</div>

<script>
const firebaseConfig = { apiKey: "AIzaSyALUTZ-W5KWoSXw5DoJ3AbeMNzFsvTurNo", authDomain: "home-2-f8b01.firebaseapp.com", databaseURL: "https://home-2-f8b01-default-rtdb.firebaseio.com", projectId: "home-2-f8b01" };
firebase.initializeApp(firebaseConfig);

const dias = ["Segunda", "TerÃ§a", "Quarta", "Quinta", "Sexta", "SÃ¡bado", "Domingo"];
const meses = ["Janeiro", "Fevereiro", "MarÃ§o", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
const LISTA_ESSENCIAL = [{val:"Arroz", cat:"Mercearia"}, {val:"FeijÃ£o", cat:"Mercearia"}, {val:"Batata", cat:"Hortifruti"}, {val:"Cebola", cat:"Hortifruti"}, {val:"Frango", cat:"AÃ§ougue"}, {val:"Carne moÃ­da", cat:"AÃ§ougue"}, {val:"Ovos", cat:"AÃ§ougue"}, {val:"PÃ£o", cat:"Padaria"}, {val:"Detergente", cat:"Limpeza"}, {val:"Papel higiÃªnico", cat:"Higiene"}, {val:"SabÃ£o pÃ³", cat:"Limpeza"}];
function getTodayName() { let idx = new Date().getDay(); return dias[idx === 0 ? 6 : idx - 1]; }

let currentGroup = localStorage.getItem('py_v26_final');
let currentUser = "";
let currentDay = getTodayName();
let currentMes = meses[new Date().getMonth()];
let currentLazerCat = "Restaurante";

let db = { config: { user1: "UsuÃ¡rio 1", user2: "UsuÃ¡rio 2", p1: 0, p2: 0 }, tarefas: {}, financasMensal: {}, lazer: [], compras: [], agenda: [], logs: [] };

function executarAuth() {
    const g = document.getElementById('auth-nome').value.trim().toLowerCase().replace('@','');
    const s = document.getElementById('auth-senha').value.trim();
    if(!g || !s) return alert("Preencha!");
    const ref = firebase.database().ref('v26_final/' + g);
    ref.once('value', snap => {
        if(snap.exists()) {
            if(snap.val().senha === s) logar(g); else alert("Senha incorreta");
        } else { if(confirm(`Cadastrar famÃ­lia @${g}?`)) ref.set({...db, senha: s}).then(() => logar(g)); }
    });
}

function logar(g) {
    currentGroup = g; localStorage.setItem('py_v26_final', g);
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('main-app').classList.remove('hidden');
    document.getElementById('display-grupo').innerText = "@" + g.toUpperCase();
    firebase.database().ref('v26_final/'+g).on('value', snap => {
        if(snap.exists()){
            db = snap.val();
            if(!currentUser) currentUser = db.config.user1;
            render();
        }
    });
}

function logout() { localStorage.removeItem('py_v26_final'); location.reload(); }
function save() { if(currentGroup) firebase.database().ref('v26_final/'+currentGroup).update(db); }

function showTab(id) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.getElementById('content-'+id).classList.add('active');
    document.querySelectorAll('nav .nav-item').forEach(b => b.classList.remove('active-nav', 'text-slate-400'));
    document.getElementById('nav-'+id).classList.add('active-nav');
    render();
}

function switchUser(u) { currentUser = u; render(); }

// FUNÃ‡Ã•ES FINANCEIRAS NOVAS (MANTENDO AS ANTIGAS)
function updateFinanca(campo, valor) {
    if(!db.financasMensal[currentMes]) db.financasMensal[currentMes] = {};
    if(!db.financasMensal[currentMes][currentUser]) db.financasMensal[currentMes][currentUser] = {};
    db.financasMensal[currentMes][currentUser][campo] = isNaN(parseFloat(valor)) ? valor : parseFloat(valor);
    save();
}

function addNovaEntrada() {
    if(!db.financasMensal[currentMes]) db.financasMensal[currentMes] = {};
    if(!db.financasMensal[currentMes][currentUser]) db.financasMensal[currentMes][currentUser] = {};
    if(!db.financasMensal[currentMes][currentUser].entradasExtras) db.financasMensal[currentMes][currentUser].entradasExtras = [];
    db.financasMensal[currentMes][currentUser].entradasExtras.push({id: Date.now(), nome: "Nova Entrada", valor: 0});
    save();
}

function updateEntradaExtra(id, campo, valor) {
    const item = db.financasMensal[currentMes][currentUser].entradasExtras.find(x => x.id === id);
    if(item) { item[campo] = campo === 'valor' ? (parseFloat(valor) || 0) : valor; save(); }
}

function addNovoCustoFixo() {
    if(!db.financasMensal[currentMes]) db.financasMensal[currentMes] = {};
    if(!db.financasMensal[currentMes][currentUser]) db.financasMensal[currentMes][currentUser] = {};
    if(!db.financasMensal[currentMes][currentUser].fixosExtras) db.financasMensal[currentMes][currentUser].fixosExtras = [];
    db.financasMensal[currentMes][currentUser].fixosExtras.push({id: Date.now(), nome: "Novo Gasto", valor: 0});
    save();
}

function updateFixoExtra(id, campo, valor) {
    const item = db.financasMensal[currentMes][currentUser].fixosExtras.find(x => x.id === id);
    if(item) { item[campo] = campo === 'valor' ? (parseFloat(valor) || 0) : valor; save(); }
}

function copiarMesAnterior() {
    const mesAtualIdx = meses.indexOf(currentMes);
    if (mesAtualIdx === 0) return alert("Janeiro Ã© o primeiro!");
    const mesAnterior = meses[mesAtualIdx - 1];
    const dadosAnt = db.financasMensal[mesAnterior] && db.financasMensal[mesAnterior][currentUser];
    if (!dadosAnt) return alert("Dados anteriores nÃ£o encontrados.");
    if (confirm(`Copiar dados de ${mesAnterior}?`)) {
        if (!db.financasMensal[currentMes]) db.financasMensal[currentMes] = {};
        db.financasMensal[currentMes][currentUser] = JSON.parse(JSON.stringify(dadosAnt));
        save();
    }
}

// FUNÃ‡Ã•ES ORIGINAIS (AGENDA, COMPRAS, TAREFAS)
function addTarefa() {
    const v = document.getElementById('novaTarefa').value; if(!v) return;
    if(!db.tarefas[currentDay]) db.tarefas[currentDay] = [];
    db.tarefas[currentDay].push({id: Date.now(), txt: v, check: false, u: currentUser});
    addLog(`Tarefa: ${v}`, 'tar'); document.getElementById('novaTarefa').value=""; save();
}
function toggleTarefa(id) {
    const t = db.tarefas[currentDay].find(x => x.id === id);
    if(t) { t.check = !t.check; if(t.check) { if(currentUser === db.config.user1) db.config.p1 += 10; else db.config.p2 += 10; } save(); }
}
function addAgenda() {
    const d = document.getElementById('agendaData').value; const t = document.getElementById('agendaComp').value; if(!d || !t) return;
    if(!db.agenda) db.agenda = []; db.agenda.push({id: Date.now(), data: d, txt: t, u: currentUser});
    addLog(`Agenda: ${t}`, 'age'); save();
}
function addSaidaVariavel() {
    const d = document.getElementById('finOutDesc').value;
    const v = parseFloat(document.getElementById('finOutValor').value);
    const c = document.getElementById('finOutCat').value;
    if(!d || !v) return;
    if(!db.financasMensal[currentMes][currentUser].saidas) db.financasMensal[currentMes][currentUser].saidas = [];
    db.financasMensal[currentMes][currentUser].saidas.push({id: Date.now(), d, v, cat: c});
    document.getElementById('finOutDesc').value = ""; document.getElementById('finOutValor').value = ""; save();
}
function addCompraManual() {
    const v = document.getElementById('compraNovoItem').value; const c = document.getElementById('compraCategoria').value; if(!v) return;
    if(!db.compras) db.compras = []; db.compras.push({ id: Date.now(), val: v, cat: c, check: false }); save(); document.getElementById('compraNovoItem').value = "";
}
function restaurarComprasEssenciais() {
    if(!db.compras) db.compras = [];
    LISTA_ESSENCIAL.forEach(item => { if(!db.compras.some(c => c.val === item.val && !c.check)) db.compras.push({...item, id: Date.now() + Math.random(), check: false}); });
    save();
}
function addLog(m, type) { if(!db.logs) db.logs = []; db.logs.unshift({u: currentUser, msg: m, h: new Date().toLocaleTimeString('pt-br',{hour:'2-digit',minute:'2-digit'}), type}); }
function toggleCalendario() { document.getElementById('modal-calendario').classList.toggle('active'); if(document.getElementById('modal-calendario').classList.contains('active')) renderCalendario(); }
function verDetalhesDia(data) {
    const evs = (db.agenda || []).filter(a => a.data === data);
    document.getElementById('calendar-details').innerHTML = evs.length ? evs.map(e => `<div class=\"card-clean p-4 border-l-4 border-indigo-400 text-xs font-bold flex justify-between\"><span>${e.txt}</span><button onclick=\"db.agenda=db.agenda.filter(x=>x.id!==${e.id});save();verDetalhesDia('${data}')\" class=\"text-slate-300\">âœ•</button></div>`).join("") : `<p class=\"text-center text-xs text-slate-300\">Vazio</p>`;
}
function addLazer() {
    const v = document.getElementById('lazerNovo').value; const c = parseFloat(document.getElementById('lazerCusto').value) || 0; if(!v) return;
    if(!db.lazer) db.lazer = []; db.lazer.push({id: Date.now(), n: v, vlr: c, cat: currentLazerCat}); save(); document.getElementById('lazerNovo').value="";
}
function sortearLazer() {
    const f = (db.financasMensal[currentMes] && db.financasMensal[currentMes][currentUser]) || {};
    const saldo = (f.lazerEntrada || 0) - (f.lazerSaida || 0);
    const lista = (db.lazer || []).filter(i => i.vlr <= saldo);
    if(!lista.length) return alert("Sem saldo!");
    const s = lista[Math.floor(Math.random()*lista.length)];
    alert(`ğŸ° SORTEIO: ${s.n} (R$ ${s.vlr})`);
}
function saveUsers() { db.config.user1 = document.getElementById('input-user1').value; db.config.user2 = document.getElementById('input-user2').value; save(); location.reload(); }
function shareWhatsApp() {
    const itens = (db.compras || []).filter(i => !i.check);
    let t = `ğŸ›’ *LISTA DE COMPRAS*\n\n`;
    const cats = [...new Set(itens.map(i => i.cat))];
    cats.forEach(c => { t += `*${c.toUpperCase()}*\n`; itens.filter(i => i.cat === c).forEach(i => t += `â€¢ ${i.val}\n`); t += `\n`; });
    window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(t)}`);
}

// RENDER
function render() {
    document.getElementById('btn-user1').innerText = db.config.user1;
    document.getElementById('btn-user2').innerText = db.config.user2;
    document.getElementById('label-user1').innerText = db.config.user1;
    document.getElementById('label-user2').innerText = db.config.user2;
    document.getElementById('ponto-user1').innerText = db.config.p1;
    document.getElementById('ponto-user2').innerText = db.config.p2;
    document.getElementById('input-user1').value = db.config.user1;
    document.getElementById('input-user2').value = db.config.user2;
    document.getElementById('fin-user-name').innerText = currentUser;

    document.getElementById('btn-user1').className = currentUser === db.config.user1 ? 'flex-1 py-2 text-[10px] font-black rounded-xl active-user-btn uppercase' : 'flex-1 py-2 text-[10px] font-bold rounded-xl uppercase text-slate-400';
    document.getElementById('btn-user2').className = currentUser === db.config.user2 ? 'flex-1 py-2 text-[10px] font-black rounded-xl active-user-btn uppercase' : 'flex-1 py-2 text-[10px] font-bold rounded-xl uppercase text-slate-400';

    // TAREFAS
    document.getElementById('list-dias').innerHTML = dias.map(d => `<button onclick=\"currentDay='${d}';render()\" class=\"px-5 py-2.5 rounded-2xl text-[9px] font-black uppercase ${currentDay===d?'bg-indigo-600 text-white shadow-md':'bg-white text-slate-400 border'}\">${d}</button>`).join("");
    const tfs = (db.tarefas[currentDay] || []).filter(t => t.u === currentUser);
    document.getElementById('tarefasList').innerHTML = tfs.map(t => `<div class=\"card-clean p-4 flex justify-between items-center\"><span class=\"text-sm font-bold ${t.check?'riscado':''}\">${t.txt}</span><div class=\"flex gap-2\"><button onclick=\"toggleTarefa(${t.id})\" class=\"w-8 h-8 rounded-full ${t.check?'bg-emerald-100 text-emerald-600':'bg-slate-50 text-slate-300'}\">âœ“</button><button onclick=\"db.tarefas['${currentDay}']=db.tarefas['${currentDay}'].filter(x=>x.id!==${t.id});save()\" class=\"text-slate-200\">âœ•</button></div></div>`).join("");

    // FINANÃ‡AS
    document.getElementById('fin-meses-nav').innerHTML = meses.map(m => `<button onclick=\"currentMes='${m}';render()\" class=\"px-4 py-2 rounded-xl text-[9px] font-black uppercase whitespace-nowrap ${currentMes===m?'bg-indigo-600 text-white':'bg-white text-slate-400 border'}\">${m}</button>`).join("");
    const f = (db.financasMensal[currentMes] && db.financasMensal[currentMes][currentUser]) || {};
    
    document.getElementById('in-salario').value = f.salario || "";
    document.getElementById('in-vr').value = f.vr || "";
    document.getElementById('in-casa-total').value = f.entradaCasa || "";
    document.getElementById('fixo-academia').value = f.fixo_academia || "";
    document.getElementById('fixo-celular').value = f.fixo_celular || "";
    document.getElementById('fixo-internet').value = f.fixo_internet || "";
    document.getElementById('fixo-alimentacao').value = f.fixo_alimentacao || "";
    document.getElementById('fin-caixinha-valor').value = f.caixinhaValor || "";
    document.getElementById('fin-caixinha-nome').value = f.caixinhaNome || "Caixinha";
    document.getElementById('fin-lazer-in').value = f.lazerEntrada || "";
    document.getElementById('fin-lazer-out').value = f.lazerSaida || "";

    // Entradas Extras
    document.getElementById('container-entradas-extras').innerHTML = (f.entradasExtras || []).map(e => `
        <div class="bg-slate-50 p-2 rounded-xl">
            <input onchange="updateEntradaExtra(${e.id}, 'nome', this.value)" value="${e.nome}" class="bg-transparent text-[8px] uppercase font-bold text-slate-400 outline-none w-full">
            <div class="flex items-center gap-1">
                <input onchange="updateEntradaExtra(${e.id}, 'valor', this.value)" type="number" value="${e.valor}" class="bg-transparent w-full font-bold outline-none text-emerald-700" placeholder="R$ 0">
                <button onclick="db.financasMensal['${currentMes}']['${currentUser}'].entradasExtras = db.financasMensal['${currentMes}']['${currentUser}'].entradasExtras.filter(x=>x.id!==${e.id});save()" class="text-slate-300">âœ•</button>
            </div>
        </div>`).join("");

    // Custos Extras
    document.getElementById('container-fixos-extras').innerHTML = (f.fixosExtras || []).map(x => `
        <div class="bg-slate-50 p-2 rounded-xl">
            <input onchange="updateFixoExtra(${x.id}, 'nome', this.value)" value="${x.nome}" class="bg-transparent text-[8px] uppercase font-bold text-slate-400 outline-none w-full">
            <div class="flex items-center gap-1">
                <input onchange="updateFixoExtra(${x.id}, 'valor', this.value)" type="number" value="${x.valor}" class="bg-transparent w-full font-bold outline-none text-rose-600" placeholder="R$ 0">
                <button onclick="db.financasMensal['${currentMes}']['${currentUser}'].fixosExtras = db.financasMensal['${currentMes}']['${currentUser}'].fixosExtras.filter(i=>i.id!==${x.id});save()" class="text-slate-300">âœ•</button>
            </div>
        </div>`).join("");

    // CÃ¡lculos
    const totEntradas = (parseFloat(f.salario)||0) + (f.entradasExtras||[]).reduce((a,b)=>a+(parseFloat(b.valor)||0),0);
    const totFixos = (parseFloat(f.fixo_academia)||0) + (parseFloat(f.fixo_celular)||0) + (parseFloat(f.fixo_internet)||0) + (parseFloat(f.fixo_alimentacao)||0) + (parseFloat(f.caixinhaValor)||0) + (parseFloat(f.lazerEntrada)||0) + (f.fixosExtras||[]).reduce((a,b)=>a+(parseFloat(b.valor)||0),0);
    const saidasVar = f.saidas || [];
    const totSaidasV = saidasVar.reduce((a, b) => a + parseFloat(b.v), 0);
    const totalLivre = totEntradas - totFixos - totSaidasV;
    const vrFinal = (f.vr || 0) - (f.fixo_alimentacao || 0);

    const percent = totEntradas > 0 ? Math.round((totFixos / totEntradas) * 100) : 0;
    document.getElementById('fin-percent-text').innerText = percent + "%";
    document.getElementById('fin-progress-bar').style.width = Math.min(percent, 100) + "%";
    document.getElementById('fin-saldo-final').innerText = totalLivre.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });

    // Render SaÃ­das com Categorias
    const saidasPorCat = saidasVar.reduce((acc, item) => { const cat = item.cat || 'Outros'; if (!acc[cat]) acc[cat] = []; acc[cat].push(item); return acc; }, {});
    document.getElementById('fin-lista-saidas').innerHTML = Object.keys(saidasPorCat).map(cat => `
        <div class=\"space-y-1\"><h4 class=\"text-[8px] font-black uppercase text-slate-400 tracking-tighter ml-1\">${cat}</h4>
            ${saidasPorCat[cat].map(s => `<div class=\"flex justify-between items-center text-xs font-bold bg-slate-50 p-2 rounded-lg border border-slate-100\"><span>${s.d}</span><div class=\"flex items-center gap-2\"><span class=\"text-rose-500\">R$ ${parseFloat(s.v).toFixed(2)}</span><button onclick=\"db.financasMensal['${currentMes}']['${currentUser}'].saidas = db.financasMensal['${currentMes}']['${currentUser}'].saidas.filter(x=>x.id!==${s.id});save()\" class=\"text-slate-300\">âœ•</button></div></div>`).join("")}
        </div>`).join("");

    document.getElementById('extra-dash-container').innerHTML = `
        <div class="grid grid-cols-2 gap-2 mt-4">
            <div class="bg-indigo-900 p-3 rounded-2xl border border-indigo-700"><p class="text-[8px] font-black text-indigo-300 uppercase">VR/VA DisponÃ­vel</p><p class="text-sm font-bold text-white">${vrFinal.toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })}</p></div>
            <div class="bg-indigo-50 p-3 rounded-2xl border border-indigo-100"><p class="text-[8px] font-black text-indigo-600 uppercase">Reserva Casa</p><p class="text-sm font-bold text-indigo-700">${(f.entradaCasa || 0).toLocaleString('pt-br', { style: 'currency', currency: 'BRL' })}</p></div>
        </div>`;

    // COMPRAS
    const comps = db.compras || [];
    const categories = [...new Set(comps.map(i => i.cat))];
    document.getElementById('comprasList').innerHTML = categories.map(cat => `
        <div class="space-y-2"><h4 class="text-[9px] font-black uppercase text-indigo-400 tracking-widest ml-2">${cat}</h4>
            ${comps.filter(i => i.cat === cat).map(i => `<div class="card-clean p-4 flex items-center justify-between"><span class="${i.check?'riscado':''} font-bold text-sm">${i.val}</span><div class="flex gap-2"><button onclick=\"const item=db.compras.find(c=>c.id===${i.id});item.check=!item.check;save()\" class=\"w-8 h-8 rounded-full ${i.check?'bg-indigo-100 text-indigo-600':'bg-slate-50 text-slate-300'}\">âœ“</button><button onclick=\"db.compras=db.compras.filter(c=>c.id!==${i.id});save()\" class=\"text-rose-300\">ğŸ—‘</button></div></div>`).join('')}
        </div>`).join("");

    // LAZER E LOGS
    const lzCats = ["Restaurante", "Bar", "Pizzarias", "Cinemas", "CafÃ©s"];
    document.getElementById('lazer-tabs').innerHTML = lzCats.map(c => `<button onclick=\"currentLazerCat='${c}';render()\" class=\"flex-1 py-3 px-2 text-[9px] font-black rounded-xl ${currentLazerCat===c?'bg-slate-900 text-white':'text-slate-400'} uppercase\">${c}</button>`).join("");
    document.getElementById('lazerList').innerHTML = (db.lazer || []).filter(x => x.cat === currentLazerCat).map(l => `<div class=\"card-clean p-4 flex justify-between items-center\"><div><p class=\"text-sm font-bold\">${l.n}</p><p class=\"text-[10px] text-slate-400\">R$ ${l.vlr}</p></div><button onclick=\"db.lazer=db.lazer.filter(x=>x.id!==${l.id});save()\" class=\"text-slate-200\">âœ•</button></div>`).join("");
    document.getElementById('lazer-orcamento-display').innerText = ((f.lazerEntrada || 0) - (f.lazerSaida || 0)).toLocaleString('pt-br', { style: 'currency', currency: 'BRL' });
    document.getElementById('logsDisplay').innerHTML = (db.logs || []).slice(0,10).map(l => `<div class=\"card-clean p-3 text-[10px] font-bold text-slate-400 uppercase\">${l.h} - ${l.u}: ${l.msg}</div>`).join("");
    document.getElementById('agendaList').innerHTML = (db.agenda || []).filter(a => a.u === currentUser).sort((a,b)=>new Date(a.data)-new Date(b.data)).slice(0,3).map(a => `<div class=\"card-clean p-4 text-xs font-bold uppercase flex justify-between\"><span>${a.data.split('-').reverse().join('/')} - ${a.txt}</span></div>`).join("");
}

function renderCalendario() {
    const container = document.getElementById('calendar-grid-container');
    const totalDias = new Date(2026, new Date().getMonth()+1, 0).getDate();
    let h = "";
    for(let d=1; d<=totalDias; d++) {
        const dStr = `2026-${String(new Date().getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const tem = (db.agenda || []).find(a => a.data === dStr);
        h += `<div onclick=\"verDetalhesDia('${dStr}')\" class=\"calendar-day ${tem?'has-event':''}\"><span>${d}</span></div>`;
    }
    container.innerHTML = h;
}

if(currentGroup) logar(currentGroup);
</script>
</body>
</html>
