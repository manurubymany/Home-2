<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planner Yourself 2026 - Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { font-family:'Plus Jakarta Sans',sans-serif; background:#F8FAFC; color: #1E293B; }
        .tab-content { display:none }
        .tab-content.active { display:block; animation:slide .25s ease-out }
        .active-nav { border-bottom:3px solid #6366f1; color:#6366f1; font-weight:800 }
        .active-sub { background:#6366f1 !important; color:white !important }
        @keyframes slide { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .active-user-btn { background: #6366f1 !important; color: white !important; box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.4); }
        .riscado { text-decoration: line-through; opacity: 0.4; filter: grayscale(1); }
    </style>
</head>
<body class="pb-10">

<section id="login-screen" class="fixed inset-0 bg-white z-[100] flex items-center justify-center p-6">
    <div class="w-full max-w-sm space-y-8">
        <div class="text-center">
            <div class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center text-white text-2xl font-black mx-auto shadow-xl">PY</div>
            <h1 class="text-2xl font-extrabold mt-4">Planner <span class="text-indigo-600">Yourself.</span></h1>
            <p class="text-slate-400 text-[10px] font-bold uppercase tracking-widest mt-1">2026 Group Management</p>
        </div>
        <div class="space-y-3">
            <input id="login-nome" type="text" placeholder="Nome do Grupo" class="w-full p-4 bg-slate-100 rounded-2xl border-none font-bold outline-none">
            <input id="login-senha" type="password" placeholder="Senha" class="w-full p-4 bg-slate-100 rounded-2xl border-none font-bold outline-none">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="fazerLogin()" class="bg-indigo-600 text-white p-4 rounded-2xl font-black shadow-lg">ENTRAR</button>
                <button onclick="fazerCadastro()" class="bg-white text-indigo-600 border-2 border-indigo-100 p-4 rounded-2xl font-black">CRIAR</button>
            </div>
        </div>
    </div>
</section>

<div id="main-app" class="hidden">
    <header class="bg-white border-b sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4 pt-4 pb-2">
            <div class="flex justify-between items-center mb-3">
                <div class="flex items-center gap-2">
                    <span id="display-grupo" class="font-black text-[10px] text-indigo-600 uppercase bg-indigo-50 px-2 py-1 rounded"></span>
                </div>
                <div class="flex bg-slate-100 p-1 rounded-full text-[10px] font-bold">
                    <button id="btn-user1" onclick="switchUser(db.config.user1)" class="px-4 py-1.5 rounded-full transition-all uppercase"></button>
                    <button id="btn-user2" onclick="switchUser(db.config.user2)" class="px-4 py-1.5 rounded-full transition-all uppercase"></button>
                </div>
                <button onclick="logout()" class="text-[9px] font-black text-rose-400 uppercase">Sair</button>
            </div>

            <nav class="flex gap-4 text-[10px] font-black uppercase overflow-x-auto no-scrollbar border-t mt-2">
                <button id="nav-casa" onclick="showTab('casa')" class="py-3 active-nav whitespace-nowrap">ğŸ  Tarefas</button>
                <button id="nav-agenda" onclick="showTab('agenda')" class="py-3 text-slate-400 whitespace-nowrap">ğŸ“… Agenda</button>
                <button id="nav-lazer" onclick="showTab('lazer')" class="py-3 text-slate-400 whitespace-nowrap">ğŸ· Lazer</button>
                <button id="nav-financeiro" onclick="showTab('financeiro')" class="py-3 text-slate-400 whitespace-nowrap">ğŸ’° FinanÃ§as</button>
                <button id="nav-compras" onclick="showTab('compras')" class="py-3 text-slate-400 whitespace-nowrap">ğŸ›’ Compras</button>
                <button id="nav-historico" onclick="showTab('historico')" class="py-3 text-slate-400 whitespace-nowrap">ğŸ“œ Logs</button>
                <button id="nav-perfil" onclick="showTab('perfil')" class="py-3 text-slate-400 whitespace-nowrap">ğŸ‘¤ Perfil</button>
            </nav>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-4 space-y-6">
        
        <section id="content-casa" class="tab-content active space-y-4">
            <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar" id="list-dias"></div>
            <div class="bg-white p-4 rounded-2xl border shadow-sm flex gap-2">
                <input id="novaTarefa" placeholder="Nova tarefa..." class="flex-1 bg-transparent outline-none font-medium text-sm">
                <button onclick="addTarefa()" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold">+</button>
            </div>
            <div id="tarefasList" class="space-y-2"></div>
        </section>

        <section id="content-agenda" class="tab-content space-y-4">
            <div class="bg-white p-4 rounded-2xl border shadow-sm space-y-3">
                <p class="text-[10px] font-black text-slate-400 uppercase">Novo Compromisso</p>
                <input type="date" id="agendaData" class="w-full p-3 bg-slate-50 rounded-xl font-bold text-sm outline-none">
                <input type="text" id="agendaComp" placeholder="O que temos agendado?" class="w-full p-3 bg-slate-50 rounded-xl font-medium text-sm outline-none">
                <button onclick="addAgenda()" class="w-full bg-indigo-600 text-white p-4 rounded-xl font-black text-xs uppercase shadow-lg">Salvar na Agenda</button>
            </div>
            <div id="agendaList" class="space-y-2"></div>
        </section>

        <section id="content-financeiro" class="tab-content space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-slate-900 p-4 rounded-2xl text-white">
                    <p class="text-[8px] font-black opacity-60 uppercase">Saldo SalÃ¡rio</p>
                    <p id="fin-salario" class="text-lg font-black mt-1">R$ 0,00</p>
                </div>
                <div class="bg-emerald-600 p-4 rounded-2xl text-white">
                    <p class="text-[8px] font-black opacity-60 uppercase">Saldo VR/VA</p>
                    <p id="fin-vrava" class="text-lg font-black mt-1">R$ 0,00</p>
                </div>
            </div>
            <div class="bg-white p-4 rounded-2xl border space-y-3">
                <input id="finValor" type="number" placeholder="Valor R$" class="w-full p-3 bg-slate-50 rounded-xl font-bold outline-none">
                <select id="finTipo" class="w-full p-3 bg-slate-50 rounded-xl text-xs font-black uppercase outline-none">
                    <optgroup label="RECEITAS">
                        <option value="rec_salario">â• Receber SalÃ¡rio (Entra no Saldo)</option>
                        <option value="rec_vrava">â• Receber VR/VA (Entra no VR)</option>
                    </optgroup>
                    <optgroup label="CUSTOS FIXOS (SALÃRIO)">
                        <option value="fix_internet">ğŸŒ Internet</option>
                        <option value="fix_celular">ğŸ“± Celular</option>
                        <option value="fix_credito">ğŸ’³ CrÃ©dito</option>
                        <option value="fix_academia">ğŸ’ª Academia</option>
                        <option value="fix_outros">âš ï¸ Outros (Com Justificativa)</option>
                    </optgroup>
                    <optgroup label="ALIMENTAÃ‡ÃƒO (VR/VA)">
                        <option value="gas_restaurante">ğŸ½ï¸ Restaurante</option>
                        <option value="gas_compra_mes">ğŸ›’ Compra do MÃªs</option>
                    </optgroup>
                </select>
                <input id="finJust" placeholder="Justificativa (ObrigatÃ³rio para 'Outros')" class="w-full p-3 bg-slate-50 rounded-xl text-sm outline-none">
                <button onclick="addFinanceiro()" class="w-full bg-indigo-600 text-white p-4 rounded-xl font-black text-xs uppercase">Registrar LanÃ§amento</button>
            </div>
        </section>

        <section id="content-lazer" class="tab-content space-y-4">
            <div class="flex gap-1 bg-slate-100 p-1 rounded-xl overflow-x-auto no-scrollbar" id="lazer-tabs"></div>
            <button onclick="sortearLazer()" class="w-full bg-gradient-to-r from-amber-400 to-orange-500 text-white p-4 rounded-2xl font-black shadow-lg text-xs uppercase">ğŸ° Sortear do Grupo</button>
            <div class="bg-white p-4 rounded-2xl border flex gap-2">
                <input id="lazerNome" placeholder="Nome do local..." class="flex-1 text-sm font-medium outline-none">
                <button onclick="addLazer()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl font-bold">+</button>
            </div>
            <div id="lazerList" class="space-y-2"></div>
        </section>

        <section id="content-compras" class="tab-content space-y-4">
            <div class="flex gap-2">
                <button onclick="restaurarCompras()" class="flex-1 bg-indigo-50 text-indigo-600 py-3 rounded-xl font-black text-[10px] uppercase border border-indigo-100">Restaurar Lista 2026</button>
                <button onclick="limparComprasTicadas()" class="flex-1 bg-rose-50 text-rose-600 py-3 rounded-xl font-black text-[10px] uppercase border border-rose-100">Remover Ticados</button>
            </div>
            <div id="comprasList" class="space-y-4"></div>
        </section>

        <section id="content-historico" class="tab-content space-y-4">
            <div id="historicoContainer" class="space-y-2"></div>
        </section>

        <section id="content-perfil" class="tab-content space-y-4">
            <div class="bg-white p-6 rounded-2xl border space-y-4 text-center shadow-sm">
                <p class="text-[10px] font-black text-slate-400 uppercase">Editar UsuÃ¡rios</p>
                <input id="input-user1" class="w-full p-3 bg-slate-50 rounded-xl font-bold border-none text-center">
                <input id="input-user2" class="w-full p-3 bg-slate-50 rounded-xl font-bold border-none text-center">
                <button onclick="saveUsers()" class="w-full bg-indigo-600 text-white p-4 rounded-2xl font-black text-xs uppercase">Salvar AlteraÃ§Ãµes</button>
            </div>
        </section>

    </main>
</div>

<script>
// --- CONFIGURAÃ‡ÃƒO FIREBASE ---
const firebaseConfig = {
    apiKey: "AIzaSyALUTZ-W5KWoSXw5DoJ3AbeMNzFsvTurNo",
    authDomain: "home-2-f8b01.firebaseapp.com",
    databaseURL: "https://home-2-f8b01-default-rtdb.firebaseio.com",
    projectId: "home-2-f8b01"
};
firebase.initializeApp(firebaseConfig);

// --- ESTADO INICIAL ---
let currentGroup = localStorage.getItem('py_group_2026_vFinal');
let currentUser = "";
let currentDay = ""; 
let currentLazerCat = "CafÃ©s";
let db = {
    config: { user1: "Manu", user2: "Pedro" },
    tarefas: {}, 
    financeiro: { salario: 0, vrava: 0 },
    lazer: [], 
    compras: [], 
    agenda: [], 
    logs: []
};

// --- FUNÃ‡Ã•ES DE ACESSO ---
function fazerCadastro() {
    const g = document.getElementById('login-nome').value.trim();
    const s = document.getElementById('login-senha').value.trim();
    if(!g || !s) return alert("Preencha Grupo e Senha");
    firebase.database().ref('v2026_final/' + g).once('value', snap => {
        if(snap.exists()) return alert("Grupo jÃ¡ existe!");
        firebase.database().ref('v2026_final/' + g).set({...db, senha: s}).then(() => logar(g));
    });
}

function fazerLogin() {
    const g = document.getElementById('login-nome').value.trim();
    const s = document.getElementById('login-senha').value.trim();
    firebase.database().ref('v2026_final/' + g).once('value', snap => {
        const d = snap.val();
        if(d && d.senha === s) logar(g); else alert("Dados incorretos!");
    });
}

function logar(g) {
    currentGroup = g;
    localStorage.setItem('py_group_2026_vFinal', g);
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('main-app').classList.remove('hidden');
    document.getElementById('display-grupo').innerText = "@" + g.toUpperCase();
    firebase.database().ref('v2026_final/' + g).on('value', snap => {
        if(snap.exists()) { db = snap.val(); if(!currentUser) currentUser = db.config.user1; render(); }
    });
}

function logout() { localStorage.removeItem('py_group_2026_vFinal'); location.reload(); }
function save() { if(currentGroup) firebase.database().ref('v2026_final/' + currentGroup).update(db); }

function registrarLog(acao) {
    if(!db.logs) db.logs = [];
    db.logs.unshift({ u: currentUser, date: new Date().toLocaleString('pt-BR'), msg: acao });
}

// --- FUNCIONALIDADES ---
function addTarefa() {
    const t = document.getElementById('novaTarefa').value; if(!t) return;
    if(!db.tarefas[currentDay]) db.tarefas[currentDay] = [];
    db.tarefas[currentDay].push({ id: Date.now(), txt: t, u: currentUser });
    registrarLog(`Adicionou tarefa: ${t} (${currentDay})`);
    document.getElementById('novaTarefa').value = ""; save();
}

function concluirTarefa(id, dia) {
    const idx = db.tarefas[dia].findIndex(x => x.id === id);
    registrarLog(`Concluiu tarefa: ${db.tarefas[dia][idx].txt}`);
    db.tarefas[dia].splice(idx, 1); save();
}

function addAgenda() {
    const d = document.getElementById('agendaData').value;
    const c = document.getElementById('agendaComp').value;
    if(!d || !c) return;
    if(!db.agenda) db.agenda = [];
    db.agenda.push({ id: Date.now(), data: d, txt: c, u: currentUser });
    registrarLog(`Agendou compromisso: ${c} para ${d}`);
    document.getElementById('agendaComp').value = ""; save();
}

function addFinanceiro() {
    const v = Number(document.getElementById('finValor').value);
    const tipo = document.getElementById('finTipo').value;
    const just = document.getElementById('finJust').value || "";
    if(!v) return;

    if(tipo === 'rec_salario') db.financeiro.salario += v;
    else if(tipo === 'rec_vrava') db.financeiro.vrava += v;
    else if(tipo.startsWith('fix_')) db.financeiro.salario -= v;
    else if(tipo.startsWith('gas_')) db.financeiro.vrava -= v;

    registrarLog(`Financeiro: ${tipo.replace(/rec_|fix_|gas_/g, '')} - R$ ${v} ${just}`);
    document.getElementById('finValor').value = ""; document.getElementById('finJust').value = ""; save();
}

function addLazer() {
    const n = document.getElementById('lazerNome').value; if(!n) return;
    if(!db.lazer) db.lazer = [];
    db.lazer.push({ id: Date.now(), n, cat: currentLazerCat });
    registrarLog(`Lazer: Adicionou ${n} em ${currentLazerCat}`);
    document.getElementById('lazerNome').value = ""; save();
}

function sortearLazer() {
    const f = (db.lazer || []).filter(x => x.cat === currentLazerCat);
    if(!f.length) return alert("Categoria vazia!");
    alert("SORTEADO: " + f[Math.floor(Math.random()*f.length)].n);
}

function toggleCompra(id) {
    const i = db.compras.findIndex(x => x.id === id);
    db.compras[i].check = !db.compras[i].check;
    save();
}

function restaurarCompras() {
    const l = [
        {c:"ğŸ¥© PROTEÃNAS", v:"Carne moÃ­da acÃ©m â€“ 1 kg"}, {c:"ğŸ¥© PROTEÃNAS", v:"Carne patinho â€“ 1 kg"}, {c:"ğŸ¥© PROTEÃNAS", v:"Peito de frango â€“ 1 kg"},
        {c:"ğŸ CARBOIDRATOS / GRÃƒOS", v:"MacarrÃ£o integral â€“ 2 kg"}, {c:"ğŸ CARBOIDRATOS / GRÃƒOS", v:"Batata â€“ 6 un"}, {c:"ğŸ CARBOIDRATOS / GRÃƒOS", v:"Aveia â€“ 1 kg"},
        {c:"ğŸ¥£ LEGUMINOSAS", v:"FeijÃ£o â€“ 2 kg"}, {c:"ğŸ¥• LEGUMES & FRUTAS", v:"MaÃ§Ã£ â€“ 5 un"}, {c:"ğŸ§€ LATICÃNIOS", v:"Mussarela â€“ 300g"},
        {c:"ğŸ¬ DIET", v:"Gelatina zero â€“ 6 un"}, {c:"ğŸ§¼ HIGIENE", v:"Papel higiÃªnico"}, {c:"ğŸ¥¤ BEBIDAS", v:"Coca-Cola 2L"}
    ];
    db.compras = l.map(i => ({ id: Math.random(), cat: i.c, val: i.v, check: false }));
    registrarLog("Restaurou lista de compras essencial");
    save();
}

function limparComprasTicadas() { db.compras = (db.compras || []).filter(x => !x.check); save(); }

function saveUsers() {
    db.config.user1 = document.getElementById('input-user1').value;
    db.config.user2 = document.getElementById('input-user2').value;
    registrarLog("Alterou nomes do perfil");
    save(); alert("Perfil salvo!");
}

function switchUser(u) { currentUser = u; render(); }
function showTab(id) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.getElementById('content-'+id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-nav', 'text-slate-400'));
    document.getElementById('nav-'+id).classList.add('active-nav');
}

// --- RENDERIZAÃ‡ÃƒO ---
function render() {
    document.getElementById('btn-user1').innerText = db.config.user1;
    document.getElementById('btn-user2').innerText = db.config.user2;
    document.getElementById('btn-user1').className = currentUser === db.config.user1 ? "px-4 py-1.5 rounded-full active-user-btn" : "px-4 py-1.5 rounded-full text-slate-400";
    document.getElementById('btn-user2').className = currentUser === db.config.user2 ? "px-4 py-1.5 rounded-full active-user-btn" : "px-4 py-1.5 rounded-full text-slate-400";
    document.getElementById('input-user1').value = db.config.user1;
    document.getElementById('input-user2').value = db.config.user2;

    const dias = ["Segunda", "TerÃ§a", "Quarta", "Quinta", "Sexta", "SÃ¡bado", "Domingo"];
    if(!currentDay) currentDay = dias[new Date().getDay() - 1] || "Segunda";
    
    document.getElementById('list-dias').innerHTML = dias.map(d => `<button onclick="currentDay='${d}';render()" class="px-4 py-2 rounded-xl text-[9px] font-black ${currentDay===d?'bg-indigo-600 text-white shadow-md':'bg-white text-slate-400 border uppercase'}">${d}</button>`).join("");
    document.getElementById('tarefasList').innerHTML = (db.tarefas[currentDay] || []).map(t => `<div class="bg-white p-3 rounded-xl border flex justify-between items-center"><div class="text-sm font-bold text-slate-700">${t.txt} <span class="text-[8px] opacity-30">(${t.u})</span></div><button onclick="concluirTarefa(${t.id},'${currentDay}')" class="text-emerald-500 font-bold">âœ“</button></div>`).join("");

    document.getElementById('agendaList').innerHTML = (db.agenda || []).sort((a,b)=>new Date(a.data)-new Date(b.data)).map(a => `<div class="bg-white p-3 rounded-xl border flex justify-between"><div><p class="text-[8px] font-black text-indigo-500">${a.data.split('-').reverse().join('/')} - ${a.u}</p><p class="text-xs font-bold">${a.txt}</p></div><button onclick="db.agenda=db.agenda.filter(x=>x.id!==${a.id});save()" class="text-rose-300">âœ•</button></div>`).join("");

    document.getElementById('fin-salario').innerText = (db.financeiro.salario || 0).toLocaleString('pt-br',{style:'currency',currency:'BRL'});
    document.getElementById('fin-vrava').innerText = (db.financeiro.vrava || 0).toLocaleString('pt-br',{style:'currency',currency:'BRL'});

    const lcat = ["CafÃ©s", "Restaurante", "Bar", "Pizzarias", "Cinemas"];
    document.getElementById('lazer-tabs').innerHTML = lcat.map(c => `<button onclick="currentLazerCat='${c}';render()" class="flex-1 py-2 px-3 text-[9px] font-black rounded-lg ${currentLazerCat===c?'active-sub':'text-slate-500'} uppercase">${c}</button>`).join("");
    document.getElementById('lazerList').innerHTML = (db.lazer || []).filter(x => x.cat === currentLazerCat).map(l => `<div class="bg-white p-3 rounded-xl border flex justify-between items-center"><span class="text-sm font-bold">${l.n}</span><button onclick="db.lazer=db.lazer.filter(x=>x.id!==${l.id});save()" class="text-rose-400 font-bold">âœ•</button></div>`).join("");

    const cats = ["ğŸ¥© PROTEÃNAS", "ğŸ CARBOIDRATOS / GRÃƒOS", "ğŸ¥£ LEGUMINOSAS", "ğŸ¥• LEGUMES & FRUTAS", "ğŸ§€ LATICÃNIOS", "ğŸ¥ª LANCHES", "ğŸ¬ DIET", "ğŸ§„ TEMPEROS", "ğŸ§¼ HIGIENE", "ğŸ¥¤ BEBIDAS"];
    let cH = "";
    cats.forEach(c => {
        const itens = (db.compras || []).filter(i => i.cat === c);
        if(itens.length) {
            cH += `<p class="text-[9px] font-black text-indigo-400 mt-4 ml-1">${c}</p>`;
            itens.forEach(i => {
                cH += `<div class="bg-white p-3 border-b flex justify-between items-center"><span onclick="toggleCompra(${i.id})" class="text-sm font-bold ${i.check?'riscado':''}">${i.val}</span><button onclick="db.compras=db.compras.filter(x=>x.id!==${i.id});save()" class="text-slate-300">âœ•</button></div>`;
            });
        }
    });
    document.getElementById('comprasList').innerHTML = cH || "<p class='text-center text-xs py-10 opacity-30'>Lista vazia</p>";

    document.getElementById('historicoContainer').innerHTML = (db.logs || []).slice(0,40).map(l => `<div class="bg-white p-3 rounded-xl border text-[10px]"><span class="font-black text-indigo-600">${l.u}</span> <span class="text-slate-400 mx-1">${l.date}</span><br><span class="font-bold text-slate-700">${l.msg}</span></div>`).join("");
}

if(currentGroup) logar(currentGroup);
</script>
</body>
</html>
